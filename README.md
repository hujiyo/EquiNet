# EquiNet

## 项目背景

在金融量化领域，如何利用历史数据预测股票未来走势一直是核心难题。传统方法往往难以捕捉复杂的时序与市场联动特征。EquiNet 基于 Transformer 架构，结合多只股票与大盘数据，致力于提升未来3天涨跌概率预测的准确性，助力量化投资与学术研究。

## 项目简介

EquiNet 是一个基于 PyTorch 的深度学习项目，支持灵活参数配置和高效GPU训练。通过对319只股票420天的历史数据建模，输出未来3天内上涨、下跌、平稳的概率分布。

## 主要特性

- **Transformer 架构**：强大的时序建模能力，适合金融数据。
- **灵活参数配置**：支持自定义模型维度、层数、训练轮数等，适应不同硬件与需求。
- **完全随机采样**：每轮训练/评估均从全体股票数据中随机采样，提升泛化能力。
- **归一化处理**：每只股票独立归一化，消除价格量级影响。
- **GPU加速**：自动检测CUDA，充分利用GPU资源。
- **训练过程评估**：每轮训练后自动评估模型当前预测准确率。
- **断点续训**：自动保存最佳模型权重，便于后续加载与继续训练。

## 目录结构

```
EquiNet/
├── data/                # 存放319个.xlsx股票数据文件
├── out/                 # 训练输出的模型权重
├── src/
│   ├── train.py         # 主训练脚本
│   ├── test_best_model.py # 模型评估脚本
│   └── ...              # 其他源码
├── README.md
└── ...
```

## 数据格式说明

- 数据目录：`./data`
- 每个`.xlsx`文件对应一只股票，包含420天数据，共319只股票。
- 字段说明（共9列）：
  - `time`：日期（如`2023/06/27`）
  - `start`：开盘价
  - `max`：最高价
  - `min`：最低价
  - `end`：收盘价
  - `volume`：股票成交量
  - `marketvolume`：市场总成交量
  - `marketlimit`：大盘涨跌幅（如-1%）
  - `marketrange`：大盘指数波动宽度

## 安装与环境

- Python 3.8+
- PyTorch
- pandas、numpy
- tqdm

安装依赖：
```bash
pip install torch pandas numpy tqdm
```

## 使用流程

1. **准备数据**
   - 将319个`.xlsx`股票数据文件放入`./data`目录下。

2. **运行训练脚本**
   ```bash
   python src/train.py
   ```
   - 按提示输入模型参数（如模型维度、训练轮数等），程序会说明参数对模型效果和参数量的影响。
   - 训练过程中显示进度、损失、学习率及每轮评估准确率。

3. **模型评估**
   - 训练完成后，模型权重保存在`./out/EquiNet{d_model}.pth`。
   - 可使用`src/test_best_model.py`对训练集、测试集、全集进行准确率评估：
     ```bash
     python src/test_best_model.py
     ```

4. **模型输出说明**
   - 输出为对未来3天的概率预测：
     - 上涨3%及以上的概率
     - 下跌2%及以下的概率
     - 保持在-2%~3%区间的概率
   - 示例输出：
     ```
     涨：21%
     跌：54%
     稳：25%
     ```

## 实验结果展示

- 支持多组参数实验，详见`src/test-result.CSV`。
- 主要指标为不同参数下的训练集、测试集、全集准确率，便于横向对比模型表现。

## 常见问题 FAQ

- **Q: 数据文件格式有要求吗？**
  - A: 需为Excel `.xlsx` 格式，字段顺序与上述一致，且每只股票420天数据。
- **Q: 如何调整模型大小？**
  - A: 运行时输入提示参数即可，模型维度越大，效果和参数量越高，但训练更慢。
- **Q: 支持多GPU吗？**
  - A: 当前版本默认单GPU，可自行扩展`DataParallel`等方式。
- **Q: 训练慢怎么办？**
  - A: 建议使用CUDA GPU，或减少模型参数/训练轮数。

## 参与贡献

1. Fork 本仓库
2. 新建分支（如 `feat_xxx`）
3. 提交代码
4. 新建 Pull Request

## 联系方式

- Issues: [Gitee Issues](https://gitee.com/yourname/EquiNet/issues)
- 邮箱: your_email@example.com

## 致谢

感谢所有开源社区贡献者及金融数据支持者。更多开源项目可参考 [Gitee Explore](https://gitee.com/explore)。
